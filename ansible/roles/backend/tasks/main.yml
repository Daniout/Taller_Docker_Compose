---
- name: Clonar repositorio backend
  ansible.builtin.git:
    repo: "https://github.com/Daniout/Taller_Docker_Compose.git"
    dest: /opt/app/backend
    version: ansible_docker_microk8s

- name: Construir imagen backend
  ansible.builtin.command:
    cmd: docker build -t backend:latest .
    chdir: /opt/app/backend/apps/backProducts

- name: Guardar imagen backend como tar
  become: true
  ansible.builtin.command:
    cmd: docker save backend:latest -o /tmp/backend-app.tar

- name: Importar imagen backend en microk8s
  become: true
  ansible.builtin.command:
    cmd: /snap/bin/microk8s ctr image import /tmp/backend-app.tar
